{% extends 'base.html' %}

{% block title %}Pré-visualização da Importação{% endblock %}

{% block content %}
<div class="dashboard-container" style="max-width: 95%;">
    <h1>Pré-visualização e Correção da Planilha</h1>
    <p>Corrija os campos marcados em vermelho. Apenas as linhas que estiverem válidas na submissão serão importadas.</p>

    <form action="{{ url_for('processar_edicao_csv') }}" method="post">
        
        <div class="ranking-container" style="max-width: 100%; overflow-x: auto;">
            <table class="preview-table">
                <thead>
                    <tr>
                        <th>Status</th>
                        {% for header in headers %}
                            <th>{{ header }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in data %}
                    <tr class="{{ 'valid-row' if row.is_valid else 'invalid-row' }}">
                        <td>
                            {% if row.is_valid %}
                                ✔️ Válido
                            {% else %}
                                ❌ Erro
                            {% endif %}
                        </td>
                        
                       {% for key in headers %}
    <td class="{{ 'cell-error' if key in row.errors else '' }}"> 
        
        <input type="text" 
               name="row-{{ loop.index0 }}-{{ key }}" 
               value="{{ row.data.get(key, '') }}"
               class="form-control"
               style="width: 180px;">
        
        {% if key in row.errors %}
            <div style="color: darkred; font-size: 0.8em; margin-top: 5px;">
                ❌ Erro: {{ row.errors.get(key, '') }}
            </div>
        {% endif %}
    </td>
{% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div style="margin-top: 30px;">
            <button type="submit" class="btn">Revalidar e Importar Linhas Válidas</button>
            
            <a href="{{ url_for('pagina_admin') }}" class="btn btn-secondary">Cancelar e Voltar</a>
        </div>

    </form>
    </div>
{% endblock %}